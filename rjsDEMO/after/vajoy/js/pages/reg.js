/*==================================================
 Copyright 20013-2014 司徒正美 and other contributors
 http://www.cnblogs.com/rubylouvre/
 https://github.com/RubyLouvre
 http://weibo.com/jslouvre/
 
 Released under the MIT license
 avalon 1.3.2 2014.7.25
 ==================================================*/

(function(DOC){function noop(){}function log(e){window.console&&avalon.config.debug&&console.log(W3C?e:e+"")}function getType(e){return e==null?String(e):typeof e=="object"||typeof e=="function"?class2type[serialize.call(e)]||"object":typeof e}function isWindow(e){return rwindow.test(serialize.call(e))}function resetNumber(e,t,n){return e===+e&&!(e%1)?e<0?e=e*-1>=t?0:e+t:e=e>t?t:e:e=n?t:0,e}function oneObject(e,t){typeof e=="string"&&(e=e.match(rword)||[]);var n={},r=t!==void 0?t:1;for(var i=0,s=e.length;i<s;i++)n[e[i]]=r;return n}function generateID(){return"avalon"+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}function isArrayLike(e){if(e&&typeof e=="object"&&!avalon.isWindow(e)){var t=e.length;if(+t===t&&!(t%1)&&t>=0)try{return{}.propertyIsEnumerable.call(e,"length")===!1?Array.isArray(e)||/^\s?function/.test(e.item||e.callee):!0}catch(n){return!0}}return!1}function modelFactory(e,t){if(Array.isArray(e)){var n=e.concat();e.length=0;var r=Collection(e);return r.push.apply(r,n),r}if(typeof e.nodeType=="number")return e;var i={};t=t||{};var s={},o={},u=[],a=arguments[2]||{},f=e.$skipArray;for(var l=0,c;c=skipProperties[l++];)typeof c!="string"&&log("warning:$skipArray["+c+"] must be a string"),delete e[c],o[c]=!0;if(Array.isArray(f))for(var l=0,c;c=f[l++];)o[c]=!0;for(var l in e)accessorFactory(l,e[l],t,o,s,u,a);i=defineProperties(i,descriptorFactory(s),o);for(var c in o)i[c]=o[c];a.vmodel=i,i.$model=t,i.$events={},i.$id=generateID(),i.$accessors=s,i[subscribers]=[];for(var l in Observable){var h=Observable[l];W3C||(h=h.bind(i)),i[l]=h}i.hasOwnProperty=function(e){return e in i.$model};for(var l=0,h;h=u[l++];)Registry[expose]=h,h(),collectSubscribers(h),delete Registry[expose];return i}function safeFire(e,t,n,r){e.$events&&Observable.$fire.call(e,t,n,r)}function accessorFactory(e,t,n,r,i,s,o){n[e]=t;if(r[e]||t&&t.nodeType||e.charAt(0)==="$"&&!o[e])return r[e]=t;var u=getType(t);if(u==="function")return r[e]=t;var a,f;if(u==="object"&&typeof t.get=="function"&&Object.keys(t).length<=2){var l=t.set,c=t.get;a=function(t){var r=o.vmodel,i=n[e],s=i;if(!arguments.length)return avalon.openComputedCollect&&collectSubscribers(a),t=n[e]=c.call(r),isEqual(i,t)||(f=void 0,safeFire(r,e,t,s)),t;if(stopRepeatAssign)return;if(typeof l=="function"){var u=r.$events[e];r.$events[e]=[],l.call(r,t),r.$events[e]=u}isEqual(f,t)||(f=t,t=n[e]=c.call(r),withProxyCount&&updateWithProxy(r.$id,e,t),notifySubscribers(a),safeFire(r,e,t,s))},s.push(a)}else rcomplexType.test(u)?(a=function(t){var r=a.$vmodel,i=r.$model;if(!arguments.length)return collectSubscribers(r),r;if(stopRepeatAssign)return;if(!isEqual(i,t)){t=a.$vmodel=updateVModel(r,t,u);var s=rebindings[t.$id];s&&s();var f=o.vmodel;n[e]=t.$model,notifySubscribers(r),safeFire(f,e,n[e],i)}},a.$vmodel=t.$model?t:modelFactory(t,t),n[e]=a.$vmodel.$model):(a=function(t){var r=n[e];if(!arguments.length)return collectSubscribers(a),r;if(!isEqual(r,t)){n[e]=t;var i=o.vmodel;withProxyCount&&updateWithProxy(i.$id,e,t),notifySubscribers(a),safeFire(i,e,t,r)}},n[e]=t);a[subscribers]=[],i[e]=a}function updateWithProxy(e,t,n){var r=withProxyPool[e];r&&r[t]&&(r[t].$val=n)}function updateVModel(e,t,n){if(n==="array"){if(!Array.isArray(t))return e;var r=t.concat();return e.clear(),e.push.apply(e,r),e}var i=e[subscribers]||[];withProxyPool[e.$id]&&(withProxyCount--,delete withProxyPool[e.$id]);var s=modelFactory(t);return rebindings[s.$id]=function(e){while(e=i.shift())(function(e){e.type&&avalon.nextTick(function(){e.rollback&&e.rollback(),bindingHandlers[e.type](e,e.vmodels)})})(e);delete rebindings[s.$id]},s}function outerHTML(){return(new XMLSerializer).serializeToString(this)}function enumerateNode(e,t){if(e&&e.childNodes){var n=e.childNodes;for(var r=0,i;i=n[r++];)if(i.tagName){var s=document.createElementNS(svgns,i.tagName.toLowerCase());ap.forEach.call(i.attributes,function(e){s.setAttribute(e.name,e.value)}),enumerateNode(i,s),t.appendChild(s)}}}function iterator(e,t,n){var r="for(var "+e+"i=0,n = this.length; i < n; i++){"+t.replace("_","((i in this) && fn.call(scope,this[i],i,this))")+"}"+n;return Function("fn,scope",r)}function fixContains(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1}function kernel(e){for(var t in e){if(!ohasOwn.call(e,t))continue;var n=e[t];typeof kernel.plugins[t]=="function"?kernel.plugins[t](n):typeof kernel[t]=="object"?avalon.mix(kernel[t],n):kernel[t]=n}return this}function escapeRegExp(e){return(e+"").replace(rregexp,"\\$&")}function hyphen(e){return e.replace(/([a-z\d])([A-Z]+)/g,"$1-$2").toLowerCase()}function camelize(e){return e.indexOf("-")<0&&e.indexOf("_")<0?e:e.replace(/[-_][^-_]/g,function(e){return e.charAt(1).toUpperCase()})}function parseData(e){try{e=e==="true"?!0:e==="false"?!1:e==="null"?null:+e+""===e?+e:rbrace.test(e)?parseJSON(e):e}catch(t){}return e}function getWindow(e){return e.window&&e.document?e:e.nodeType===9?e.defaultView||e.parentWindow:!1}function showHidden(e,t){if(e.offsetWidth<=0){if(rdisplayswap.test(cssHooks["@:get"](e,"display"))){var n={node:e};for(var r in cssShow)n[r]=e.style[r],e.style[r]=cssShow[r];t.push(n)}var i=e.parentNode;i&&i.nodeType==1&&showHidden(i,t)}}function getValType(e){var t=e.tagName.toLowerCase();return t==="input"&&/checkbox|radio/.test(e.type)?"checked":t}function registerSubscriber(e,t){Registry[expose]=e,avalon.openComputedCollect=!0;var n=e.evaluator;if(n)if(e.type==="duplex")e.handler();else try{e.handler(n.apply(0,e.args),e.element,e)}catch(r){delete e.evaluator,e.nodeType===3&&(kernel.commentInterpolate?e.element.replaceChild(DOC.createComment(e.value),e.node):e.node.data=openTag+e.value+closeTag),log("warning:evaluator of ["+e.value+"] throws error!")}else e();avalon.openComputedCollect=!1,delete Registry[expose]}function collectSubscribers(e){if(Registry[expose]){var t=e[subscribers];t&&avalon.Array.ensure(t,Registry[expose])}}function notifySubscribers(e){var t=e[subscribers];if(t&&t.length){var n=aslice.call(arguments,1);for(var r=t.length,i;i=t[--r];){var s=i.element,o;s&&!avalon.contains(ifSanctuary,s)&&(typeof s.sourceIndex=="number"?o=s.sourceIndex===0:o=!avalon.contains(root,s)),o?(t.splice(r,1),log("debug: remove "+i.name)):typeof i=="function"?i.apply(0,n):i.getter?i.handler.apply(i,n):i.handler(i.evaluator.apply(0,i.args||[]),s,i)}}}function checkScan(e,t){var n=NaN,r=setInterval(function(){var i=e.innerHTML;i===n?(clearInterval(r),t()):n=i},interval)}function scanTag(e,t,n){var r=e.getAttribute(prefix+"skip");if(!e.getAttributeNode)return log("warning "+e.tagName+" no getAttributeNode method");var i=e.getAttributeNode(prefix+"important"),s=e.getAttributeNode(prefix+"controller");if(typeof r=="string")return;if(n=i||s){var o=VMODELS[n.value];if(!o)return;t=n===i?[o]:[o].concat(t),e.removeAttribute(n.name),o.$events.element=e,avalon.bind(e,"dataavailable",function(t){typeof t.detail=="object"&&e!==t.target&&o.$fire.apply(o,t.detail)}),avalon(e).removeClass(n.name)}scanAttr(e,t)}function scanNodes(e,t){var n=e.firstChild;while(n){var r=n.nextSibling,i=n.nodeType;i===1?scanTag(n,t):i===3&&rexpr.test(n.data)?scanText(n,t):kernel.commentInterpolate&&i===8&&!rexpr.test(n.nodeValue)&&scanText(n,t),n=r}}function scanText(e,t){var n=[];if(e.nodeType===8){var r=[],i=trimFilter(e.nodeValue,r),s={expr:!0,value:i};r.length&&(s.filters=r);var o=[s]}else o=scanExpr(e.data);if(o.length){for(var u=0,s;s=o[u++];){var a=DOC.createTextNode(s.value);if(s.expr){var f=s.filters,l={type:"text",node:a,nodeType:3,value:s.value,filters:f};f&&f.indexOf("html")!==-1&&(avalon.Array.remove(f,"html"),l.type="html",l.replaceNodes=[a],f.length||delete n.filters),n.push(l)}hyperspace.appendChild(a)}e.parentNode.replaceChild(hyperspace,e),n.length&&executeBindings(n,t)}}function scanAttr(e,t){var n=getAttributes?getAttributes(e):e.attributes,r=[],i={},s;for(var o=0,u;u=n[o++];)if(u.specified)if(s=u.name.match(rmsAttr)){var a=s[1],f=s[2]||"";i[u.name]=u.value,ons[a]&&(f=a,a="on");if(typeof bindingHandlers[a]=="function"){var l={type:a,param:f,element:e,name:s[0],value:u.value,priority:a in priorityMap?priorityMap[a]:a.charCodeAt(0)*10+(Number(f)||0)};a==="if"&&f.indexOf("loop")>-1&&(l.priority+=100),t.length&&(r.push(l),a==="widget"&&(e.msData=e.msData||i))}}r.sort(function(e,t){return e.priority-t.priority}),i["ms-checked"]&&i["ms-duplex"]&&log("warning!一个元素上不能同时定义ms-checked与ms-duplex");var c=r[0]||{};switch(c.type){case"if":case"repeat":case"widget":executeBindings([c],t);break;default:executeBindings(r,t),!stopScan[e.tagName]&&rbind.test(e.innerHTML.replace(rlt,"<").replace(rgt,">"))&&scanNodes(e,t)}e.patchRepeat&&(e.patchRepeat(),e.patchRepeat=null)}function executeBindings(e,t){for(var n=0,r;r=e[n++];)r.vmodels=t,bindingHandlers[r.type](r,t),r.evaluator&&r.name&&r.element.removeAttribute(r.name);e.length=0}function trimFilter(e,t){return e.indexOf("|")>0&&(e=e.replace(r11a,"U2hvcnRDaXJjdWl0"),e=e.replace(rfilters,function(e,n,r){return t.push(n+(r||"")),""}),e=e.replace(r11b,"||")),e}function scanExpr(e){var t=[],n,r=0,i;do{i=e.indexOf(openTag,r);if(i===-1)break;n=e.slice(r,i),n&&t.push({value:n,expr:!1}),r=i+openTag.length,i=e.indexOf(closeTag,r);if(i===-1)break;n=e.slice(r,i);if(n){var s=[];n=trimFilter(n,s),t.push({value:n,expr:!0,filters:s.length?s:void 0})}r=i+closeTag.length}while(1);return n=e.slice(r),n&&t.push({value:n,expr:!1}),t}function addAssign(e,t,n,r){var i=[],s=" = "+n+".";for(var o=e.length,u;u=e[--o];)t.hasOwnProperty&&t.hasOwnProperty(u)&&(i.push(u+s+u),r==="duplex"&&(e.get=n+"."+u),e.splice(o,1));return i}function uniqVmodels(e){var t={};return e.filter(function(e){if(!t[e.$id])return t[e.$id]=1,!0})}function createCache(e){function n(r,i){return t.push(r)>e&&delete n[t.shift()],n[r]=i}var t=[];return n}function parseExpr(e,t,n,r){var i=n.type,s=i=="html"||i==="text"?n.filters:"",o=t.map(function(e){return e.$id.replace(rproxy,"$1")})+e+i+s,u=getVariables(e).concat(),a=[],f=[],l=[],c="";t=uniqVmodels(t);for(var h=0,p=t.length;h<p;h++)if(u.length){var d="vm"+expose+"_"+h;f.push(d),l.push(t[h]),a.push.apply(a,addAssign(u,t[h],d,r))}if(!a.length&&r==="duplex")return;s&&l.push(avalon.filters),n.args=l;var v=cacheExprs[o];if(v){n.evaluator=v;return}var c=a.join(", ");c&&(c="var "+c);if(s){e="\nvar ret"+expose+" = "+e;var m=[],g;m.push(e,"\r\n");for(var h=0,y;y=n.filters[h++];){var b=y.indexOf("(");b!==-1?(g=y.slice(b+1,y.lastIndexOf(")")).trim(),g=","+g,y=y.slice(0,b).trim()):g="",m.push(" if(filters",expose,".",y,"){\n	try{\nret",expose," = filters",expose,".",y,"(ret",expose,g,")\n	}catch(e){} \n}\n")}e=m.join(""),e+="\nreturn ret"+expose,f.push("filters"+expose)}else{if(i==="duplex"){var w="\nreturn function(vvv){\n	"+c+";\n	if(!arguments.length){\n		return "+e+"\n	}\n	"+(rduplex.test(e)?e:u.get)+"= vvv;\n} ";try{v=Function.apply(noop,f.concat(w)),n.evaluator=cacheExprs(o,v)}catch(E){log("debug: parse error,"+E.message)}return}if(i==="on"){e=e.replace("(",".call(this,"),r==="$event"&&f.push(r),e="\nreturn "+e+";";var S=e.lastIndexOf("\nreturn"),x=e.slice(0,S),T=e.slice(S);e=x+"\nif(avalon.openComputedCollect) return ;"+T}else e="\nreturn "+e+";"}try{v=Function.apply(noop,f.concat("\n"+c+e)),n.evaluator=cacheExprs(o,v)}catch(E){log("debug: parse error,"+E.message)}finally{u=m=f=null}}function parseExprProxy(e,t,n,r){if(Array.isArray(r)){var i=r.map(function(e){var n={};return e.expr?parseExpr(e.value,t,n)||n:e.value});n.evaluator=function(){var e="";for(var t=0,n;n=i[t++];)e+=typeof n=="string"?n:n.evaluator.apply(0,n.args);return e},n.args=[]}else parseExpr(e,t,n,r);n.evaluator&&(n.handler=bindingExecutors[n.handlerName||n.type],n.evaluator.toString=function(){return n.type+" binding to eval("+e+")"},registerSubscriber(n))}function parseDisplay(e,t){e=e.toLowerCase();if(!cacheDisplay[e]){var n=DOC.createElement(e);root.appendChild(n),W3C?t=getComputedStyle(n,null).display:t=n.currentStyle.display,root.removeChild(n),cacheDisplay[e]=t}return cacheDisplay[e]}function W3CFire(e,t,n){var r=DOC.createEvent("Events");r.initEvent(t,!0,!0),n&&(r.detail=n),e.dispatchEvent(r)}function onTree(){!this.disabled&&this.oldValue!==this.value&&(W3C?W3CFire(this,"input"):this.fireEvent("onchange"))}function ticker(){for(var e=ribbon.length-1;e>=0;e--){var t=ribbon[e];avalon.contains(root,t)?t.onTree&&t.onTree():t.msRetain||(t.offTree&&t.offTree(),ribbon.splice(e,1))}ribbon.length||clearInterval(TimerID)}function launchImpl(e){ribbon.push(e)===1&&(TimerID=setInterval(ticker,30))}function newSetter(e){oldSetter.call(this,e),e!==this.oldValue&&W3CFire(this,"input")}function fixEvent(e){var t={};for(var n in e)t[n]=e[n];var r=t.target=e.srcElement;if(e.type.indexOf("key")===0)t.which=e.charCode!=null?e.charCode:e.keyCode;else if(/mouse|click/.test(e.type)){var i=r.ownerDocument||DOC,s=i.compatMode==="BackCompat"?i.body:i.documentElement;t.pageX=e.clientX+(s.scrollLeft>>0)-(s.clientLeft>>0),t.pageY=e.clientY+(s.scrollTop>>0)-(s.clientTop>>0)}return t.timeStamp=new Date-0,t.originalEvent=e,t.preventDefault=function(){e.returnValue=!1},t.stopPropagation=function(){e.cancelBubble=!0},t}function Collection(e){var t=[];t.$id=generateID(),t[subscribers]=[],t.$model=e,t.$events={},t._=modelFactory({length:e.length}),t._.$watch("length",function(e,n){t.$fire("length",e,n)});for(var n in Observable)t[n]=Observable[n];return avalon.mix(t,CollectionPrototype),t}function convert(e){return rcomplexType.test(avalon.type(e))&&(e=e.$id?e:modelFactory(e,e)),e}function expelFromSanctuary(e){var t=queryComments(e);for(var n=0,r;r=t[n++];)r.nodeValue=="ms-if"&&cinerator.appendChild(r.elem);while(r=e.firstChild)cinerator.appendChild(r);cinerator.innerHTML=""}function iteratorCallback(e){var t=getBindingCallback(this.callbackElement,this.callbackName,this.vmodels);if(t){var n=this.parent;checkScan(n,function(){t.apply(n,e)})}}function shimController(e,t,n,r){function u(){delete VMODELS[s],e.group=1;if(!e.fastRepeat){e.group=o.childNodes.length,o.parentNode.removeChild(o);while(o.firstChild)t.appendChild(o.firstChild);u.node!==void 0&&u.parent.insertBefore(t,u.node)}}var i=e.template.cloneNode(!0),s=r.$id,o=i.firstChild;return e.fastRepeat||(o=DOC.createElement("msloop"),o.style.display="none",o.appendChild(i)),o.setAttribute("ms-controller",s),n.push(o),t.appendChild(o),r.$outer=e.$outer,VMODELS[s]=r,o.patchRepeat=u}function getLocatedNode(e,t,n){if(t.startRepeat){var r=t.startRepeat,i=t.endRepeat;n+=1;for(var s=0;s<n;s++){r=r.nextSibling;if(r==i)return i}return r}return e.childNodes[t.group*n]||null}function removeView(e,t,n){var r=t*(n||1),i=hyperspace;while(--r>=0){var s=e.nextSibling;i.appendChild(e),e=s;if(!e)break}return i}function createWithProxy(e,t,n){var r=modelFactory({$key:e,$outer:n,$val:t},0,{$val:1,$key:1});return r.$id="$proxy$with"+Math.random(),r}function getEachProxy(e,t,n,r){var i=n.param||"el",s,o={$remove:function(){return n.getter().removeAt(s.$index)},$itemName:i,$index:e,$outer:n.$outer,$first:e===0,$last:e===r};o[i]=t;for(var u=0,a=eachProxyPool.length;u<a;u++){var s=eachProxyPool[u];if(s.hasOwnProperty(i)){for(var u in o)s[u]=o[u];return eachProxyPool.splice(u,1),s}}return rcomplexType.test(avalon.type(t))&&(o.$skipArray=[i]),s=modelFactory(o,0,watchEachOne),s.$id="$proxy$"+n.type+Math.random(),s}function recycleEachProxy(e){var t=e.$accessors,n=e.$itemName;["$index","$last","$first"].forEach(function(e){t[e][subscribers].length=0}),e[n][subscribers]&&(e[n][subscribers].length=0),eachProxyPool.unshift(e)>kernel.maxRepeatSize&&eachProxyPool.pop()}function fireReady(){DOC.body&&(modules["ready!"].state=2,innerRequire.checkDeps(),fireReady=noop)}function doScrollCheck(){try{root.doScroll("left"),fireReady()}catch(e){setTimeout(doScrollCheck)}}var prefix="ms-",expose=new Date-0,subscribers="$"+expose,window=this||(0,eval)("this"),otherRequire=window.require,otherDefine=window.define,stopRepeatAssign=!1,rword=/[^, ]+/g,rnative=/\[native code\]/,rcomplexType=/^(?:object|array)$/,rwindow=/^\[object (Window|DOMWindow|global)\]$/,oproto=Object.prototype,ohasOwn=oproto.hasOwnProperty,serialize=oproto.toString,ap=Array.prototype,aslice=ap.slice,Registry={},W3C=window.dispatchEvent,root=DOC.documentElement,head=DOC.getElementsByTagName("head")[0],hyperspace=DOC.createDocumentFragment(),cinerator=DOC.createElement("div"),class2type={};"Boolean Number String Function Array Date RegExp Object Error".replace(rword,function(e){class2type["[object "+e+"]"]=e.toLowerCase()}),avalon=function(e){return new avalon.init(e)},avalon.init=function(e){this[0]=this.element=e},avalon.fn=avalon.prototype=avalon.init.prototype,avalon.type=getType,avalon.isWindow=function(e){return e?e==e.document&&e.document!=e:!1},isWindow(window)&&(avalon.isWindow=isWindow),avalon.isPlainObject=function(e){if(getType(e)!=="object"||e.nodeType||this.isWindow(e))return!1;try{if(e.constructor&&!ohasOwn.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},rnative.test(Object.getPrototypeOf)&&(avalon.isPlainObject=function(e){return!!e&&typeof e=="object"&&Object.getPrototypeOf(e)===oproto}),avalon.mix=avalon.fn.mix=function(){var e,t,n,r,i,s,o=arguments[0]||{},u=1,a=arguments.length,f=!1;typeof o=="boolean"&&(f=o,o=arguments[1]||{},u++),typeof o!="object"&&getType(o)!=="function"&&(o={}),u===a&&(o=this,u--);for(;u<a;u++)if((e=arguments[u])!=null)for(t in e){n=o[t],r=e[t];if(o===r)continue;f&&r&&(avalon.isPlainObject(r)||(i=Array.isArray(r)))?(i?(i=!1,s=n&&Array.isArray(n)?n:[]):s=n&&avalon.isPlainObject(n)?n:{},o[t]=avalon.mix(f,s,r)):r!==void 0&&(o[t]=r)}return o},avalon.mix({rword:rword,subscribers:subscribers,version:1.3,ui:{},log:log,slice:W3C?function(e,t,n){return aslice.call(e,t,n)}:function(e,t,n){var r=[],i=e.length;t=resetNumber(t,i),n=resetNumber(n,i,1);for(var s=t;s<n;++s)r[s-t]=e[s];return r},noop:noop,error:function(e,t){throw new(t||Error)(e)},oneObject:oneObject,range:function(e,t,n){n||(n=1),t==null&&(t=e||0,e=0);var r=-1,i=Math.max(0,Math.ceil((t-e)/n)),s=Array(i);while(++r<i)s[r]=e,e+=n;return s},eventHooks:{},bind:function(e,t,n,r){var i=avalon.eventHooks,s=i[t];typeof s=="object"&&(t=s.type,s.deel&&(n=s.deel(e,n)));var o=W3C?n:function(t){n.call(e,fixEvent(t))};return W3C?e.addEventListener(t,o,!!r):e.attachEvent("on"+t,o),o},unbind:function(e,t,n,r){var i=avalon.eventHooks,s=i[t],o=n||noop;typeof s=="object"&&(t=s.type),W3C?e.removeEventListener(t,o,!!r):e.detachEvent("on"+t,o)},css:function(e,t,n){e instanceof avalon&&(e=e[0]);var r=/[_-]/.test(t)?camelize(t):t;t=avalon.cssName(r)||r;if(n===void 0||typeof n=="boolean"){var i=cssHooks[r+":get"]||cssHooks["@:get"],s=i(e,t);return n===!0?parseFloat(s)||0:s}if(n==="")e.style[t]="";else{if(n==null||n!==n)return;isFinite(n)&&!avalon.cssNumber[r]&&(n+="px"),i=cssHooks[r+":set"]||cssHooks["@:set"],i(e,t,n)}},each:function(e,t){if(e){var n=0;if(isArrayLike(e))for(var r=e.length;n<r;n++)t(n,e[n]);else for(n in e)e.hasOwnProperty(n)&&t(n,e[n])}},getWidgetData:function(e,t){var n=avalon(e).data(),r={};for(var i in n)i.indexOf(t)===0&&(r[i.replace(t,"").replace(/\w/,function(e){return e.toLowerCase()})]=n[i]);return r},Array:{ensure:function(e,t){return e.indexOf(t)===-1&&e.push(t),e},removeAt:function(e,t){return!!e.splice(t,1).length},remove:function(e,t){var n=e.indexOf(t);return~n?avalon.Array.removeAt(e,n):!1}}}),avalon.nextTick=window.setImmediate?setImmediate.bind(window):function(e){setTimeout(e,0)};var VMODELS=avalon.vmodels={};avalon.define=function(e,t){VMODELS[e]&&log("warning: "+e+" 已经存在于avalon.vmodels中");var n={$watch:noop};t(n);var r=modelFactory(n);return stopRepeatAssign=!0,t(r),stopRepeatAssign=!1,r.$id=e,VMODELS[e]=r};var skipProperties=String("$id,$watch,$unwatch,$fire,$events,$model,$skipArray,$accessors,"+subscribers).match(rword),isEqual=Object.is||function(e,t){return e===0&&t===0?1/e===1/t:e!==e?t!==t:e===t},descriptorFactory=W3C?function(e){var t={};for(var n in e)t[n]={get:e[n],set:e[n],enumerable:!0,configurable:!0};return t}:function(e){return e},withProxyPool={},withProxyCount=0,rebindings={},defineProperty=Object.defineProperty;try{defineProperty({},"_",{value:"x"});var defineProperties=Object.defineProperties}catch(e){"__defineGetter__"in avalon&&(defineProperty=function(e,t,n){return"value"in n&&(e[t]=n.value),"get"in n&&e.__defineGetter__(t,n.get),"set"in n&&e.__defineSetter__(t,n.set),e},defineProperties=function(e,t){for(var n in t)t.hasOwnProperty(n)&&defineProperty(e,n,t[n]);return e})}if(!defineProperties&&window.VBArray){window.execScript(["Function parseVB(code)","	ExecuteGlobal(code)","End Function","Dim VBClassBodies",'Set VBClassBodies=CreateObject("Scripting.Dictionary")',"Function findOrDefineVBClass(name,body)","	Dim found",'	found=""',"	For Each key in VBClassBodies","		If body=VBClassBodies.Item(key) Then","			found=key","			Exit For","		End If","	next",'	If found="" Then','		parseVB("Class " + name + body)',"		VBClassBodies.Add name, body","		found=name","	End If","	findOrDefineVBClass=found","End Function"].join("\n"),"VBScript");function VBMediator(e,t,n){var r=e[t];if(typeof r=="function"){if(arguments.length!==3)return r();r(n)}}defineProperties=function(e,t,n){var r="VBClass"+setTimeout("1"),i=[];i.push("\r\n	Private [__data__], [__proxy__]","	Public Default Function [__const__](d, p)","		Set [__data__] = d: set [__proxy__] = p","		Set [__const__] = Me","	End Function");for(e in n)i.push("	Public ["+e+"]");i.push("	Public [hasOwnProperty]");for(e in t)e in n||i.push("	Public Property Let ["+e+"](val"+expose+")",'		Call [__proxy__]([__data__], "'+e+'", val'+expose+")","	End Property","	Public Property Set ["+e+"](val"+expose+")",'		Call [__proxy__]([__data__], "'+e+'", val'+expose+")","	End Property","	Public Property Get ["+e+"]","	On Error Resume Next","		Set["+e+'] = [__proxy__]([__data__],"'+e+'")',"	If Err.Number <> 0 Then","		["+e+'] = [__proxy__]([__data__],"'+e+'")',"	End If","	On Error Goto 0","	End Property");i.push("End Class");var s=i.join("\r\n"),o=window.findOrDefineVBClass(r,s);o==r&&window.parseVB(["Function "+r+"Factory(a, b)","	Dim o","	Set o = (New "+r+")(a, b)","	Set "+r+"Factory = o","End Function"].join("\r\n"));var u=window[o+"Factory"](t,VBMediator);return u}}if(!"司徒正美".trim){var rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(rtrim,"")}}var svgns="http://www.w3.org/2000/svg";if(window.SVGElement){var svg=document.createElementNS(svgns,"svg");svg.innerHTML='<Rect width="300" height="100"/>',(!svg.firstChild||svg.firstChild.tagName!=="rect")&&Object.defineProperties(SVGElement.prototype,{outerHTML:{enumerable:!0,configurable:!0,get:outerHTML,set:function(e){var t=this.tagName.toLowerCase(),n=this.parentNode,r=avalon.parseHTML(e);if(t==="svg")n.insertBefore(r,this);else{var i=document.createDocumentFragment();enumerateNode(r,i),n.insertBefore(i,this)}n.removeChild(this)}},innerHTML:{enumerable:!0,configurable:!0,get:function(){var e=this.outerHTML,t=new RegExp("<"+this.nodeName+'\\b(?:(["\'])[^"]*?(\\1)|[^>])*>',"i"),n=new RegExp("</"+this.nodeName+">$","i");return e.replace(t,"").replace(n,"")},set:function(e){avalon.clearHTML(this);var t=avalon.parseHTML(e);enumerateNode(t,this)}}})}!root.outerHTML&&window.HTMLElement&&HTMLElement.prototype.__defineGetter__("outerHTML",outerHTML);var enumerables="propertyIsEnumerable,isPrototypeOf,hasOwnProperty,toLocaleString,toString,valueOf,constructor".split(",");for(var i in{toString:1})enumerables=!1;Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);if(enumerables&&e)for(var r=0;n=enumerables[r++];)e.hasOwnProperty(n)&&t.push(n);return t}),Array.isArray||(Array.isArray=function(e){return e&&getType(e)==="array"}),noop.bind||(Function.prototype.bind=function(e){if(arguments.length<2&&e===void 0)return this;var t=this,n=arguments;return function(){var r=[],i;for(i=1;i<n.length;i++)r.push(n[i]);for(i=0;i<arguments.length;i++)r.push(arguments[i]);return t.apply(e,r)}}),rnative.test([].map)||avalon.mix(ap,{indexOf:function(e,t){var n=this.length,r=~~t;r<0&&(r+=n);for(;r<n;r++)if(this[r]===e)return r;return-1},lastIndexOf:function(e,t){var n=this.length,r=t==null?n-1:t;r<0&&(r=Math.max(0,n+r));for(;r>=0;r--)if(this[r]===e)return r;return-1},forEach:iterator("","_",""),filter:iterator("r=[],j=0,","if(_)r[j++]=this[i]","return r"),map:iterator("r=[],","r[i]=_","return r"),some:iterator("","if(_)return true","return false"),every:iterator("","if(!_)return false","return true")}),root.contains||(Node.prototype.contains=function(e){return!!(this.compareDocumentPosition(e)&16)}),DOC.contains||(DOC.contains=function(e){return fixContains(this,e)});var openTag,closeTag,rexpr,rexprg,rbind,rregexp=/[-.*+?^${}()|[\]\/\\]/g,plugins={loader:function(e){window.define=e?innerRequire.define:otherDefine,window.require=e?innerRequire:otherRequire},interpolate:function(e){openTag=e[0],closeTag=e[1];if(openTag===closeTag)throw new SyntaxError("openTag!==closeTag");if(e+""=="<!--,-->")kernel.commentInterpolate=!0;else{var t=openTag+"test"+closeTag;cinerator.innerHTML=t;if(cinerator.innerHTML!==t&&cinerator.innerHTML.indexOf("&lt;")>=0)throw new SyntaxError("此定界符不合法");cinerator.innerHTML=""}var n=escapeRegExp(openTag),r=escapeRegExp(closeTag);rexpr=new RegExp(n+"(.*?)"+r),rexprg=new RegExp(n+"(.*?)"+r,"g"),rbind=new RegExp(n+".*?"+r+"|\\sms-")}};kernel.debug=!0,kernel.plugins=plugins,kernel.plugins.interpolate(["{{","}}"]),kernel.paths={},kernel.shim={},kernel.maxRepeatSize=100,avalon.config=kernel;var rnospaces=/\S+/g;avalon.fn.mix({hasClass:function(e){var t=this[0]||{};return t.nodeType===1&&t.className?(" "+t.className+" ").indexOf(" "+e+" ")>-1:!1},addClass:function(e){var t=this[0]||{};if(e&&typeof e=="string"&&t.nodeType===1)if(!t.className)t.className=e;else{var n=t.className.match(rnospaces);e.replace(rnospaces,function(e){n.indexOf(e)===-1&&n.push(e)}),t.className=n.join(" ")}return this},removeClass:function(e){var t=this[0]||{};if(e&&typeof e>"o"&&t.nodeType===1&&t.className){var n=(e||"").match(rnospaces)||[],r=n.length,i=" "+t.className.match(rnospaces).join(" ")+" ";for(var s=0;s<r;s++)i=i.replace(" "+n[s]+" "," ");t.className=i.slice(1,i.length-1)}return this},toggleClass:function(e,t){var n=t,r,i=0,s=e.match(rnospaces)||[],o=typeof t=="boolean";while(r=s[i++])n=o?n:!this.hasClass(r),this[n?"addClass":"removeClass"](r);return this},attr:function(e,t){return arguments.length===2?(this[0].setAttribute(e,t),this):this[0].getAttribute(e)},data:function(e,t){e="data-"+hyphen(e||"");switch(arguments.length){case 2:return this.attr(e,t),this;case 1:var n=this.attr(e);return parseData(n);case 0:var r={};return ap.forEach.call(this[0].attributes,function(t){t&&(e=t.name,e.indexOf("data-")||(e=camelize(e.slice(5)),r[e]=parseData(t.value)))}),r}},removeData:function(e){return e="data-"+hyphen(e),this[0].removeAttribute(e),this},css:function(e,t){if(avalon.isPlainObject(e))for(var n in e)avalon.css(this,n,e[n]);else var r=avalon.css(this,e,t);return r!==void 0?r:this},position:function(){var e,t,n=this[0],r={top:0,left:0};if(!n)return;return this.css("position")==="fixed"?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),e[0].tagName!=="HTML"&&(r=e.offset()),r.top+=avalon.css(e[0],"borderTopWidth",!0),r.left+=avalon.css(e[0],"borderLeftWidth",!0)),{top:t.top-r.top-avalon.css(n,"marginTop",!0),left:t.left-r.left-avalon.css(n,"marginLeft",!0)}},offsetParent:function(){var e=this[0].offsetParent||root;while(e&&e.tagName!=="HTML"&&avalon.css(e,"position")==="static")e=e.offsetParent;return avalon(e||root)},bind:function(e,t,n){if(this[0])return avalon.bind(this[0],e,t,n)},unbind:function(e,t,n){return this[0]&&avalon.unbind(this[0],e,t,n),this},val:function(e){var t=this[0];if(t&&t.nodeType===1){var n=arguments.length===0,r=n?":get":":set",i=valHooks[getValType(t)+r];if(i)var s=i(t,e);else{if(n)return(t.value||"").replace(/\r/g,"");t.value=e}}return n?s:this}});var rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,rvalidchars=/^[\],:{}\s]*$/,rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g,rvalidescape=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,rvalidtokens=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,parseJSON=window.JSON?JSON.parse:function(e){if(typeof e=="string"){e=e.trim();if(e&&rvalidchars.test(e.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,"")))return(new Function("return "+e))();avalon.error("Invalid JSON: "+e)}};avalon.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){avalon.fn[e]=function(n){var r=this[0]||{},i=getWindow(r),s=e==="scrollTop";if(!arguments.length)return i?t in i?i[t]:root[e]:r[e];i?i.scrollTo(s?avalon(i).scrollLeft():n,s?n:avalon(i).scrollTop()):r[e]=n}});var cssHooks=avalon.cssHooks={},prefixes=["","-webkit-","-o-","-moz-","-ms-"],cssMap={"float":"cssFloat",background:"backgroundColor"};avalon.cssNumber=oneObject("columnCount,order,fillOpacity,fontWeight,lineHeight,opacity,orphans,widows,zIndex,zoom"),avalon.cssName=function(e,t,n){if(cssMap[e])return cssMap[e];t=t||root.style;for(var r=0,i=prefixes.length;r<i;r++){n=camelize(prefixes[r]+e);if(n in t)return cssMap[e]=n}return null},cssHooks["@:set"]=function(e,t,n){try{e.style[t]=n}catch(r){}};if(window.getComputedStyle)cssHooks["@:get"]=function(e,t){if(!e||!e.style)throw new Error("getComputedStyle要求传入一个节点 "+e);var n,r=getComputedStyle(e,null);return r&&(n=t==="filter"?r.getPropertyValue(t):r[t],n===""&&(n=e.style[t])),n},cssHooks["opacity:get"]=function(e){var t=cssHooks["@:get"](e,"opacity");return t===""?"1":t};else{var rnumnonpx=/^-?(?:\d*\.)?\d+(?!px)[^\d\s]+$/i,rposition=/^(top|right|bottom|left)$/,ie8=!!window.XDomainRequest,salpha="DXImageTransform.Microsoft.Alpha",border={thin:ie8?"1px":"2px",medium:ie8?"3px":"4px",thick:ie8?"5px":"6px"};cssHooks["@:get"]=function(e,t){var n=e.currentStyle,r=n[t];if(rnumnonpx.test(r)&&!rposition.test(r)){var i=e.style,s=i.left,o=e.runtimeStyle.left;e.runtimeStyle.left=n.left,i.left=t==="fontSize"?"1em":r||0,r=i.pixelLeft+"px",i.left=s,e.runtimeStyle.left=o}return r==="medium"&&(t=t.replace("Width","Style"),n[t]==="none"&&(r="0px")),r===""?"auto":border[r]||r},cssHooks["opacity:set"]=function(e,t,n){e.style.filter="alpha(opacity="+n*100+")",e.style.zoom=1},cssHooks["opacity:get"]=function(e){var t=e.filters.alpha||e.filters[salpha],n=t?t.opacity:100;return n/100+""}}"top,left".replace(rword,function(e){cssHooks[e+":get"]=function(t){var n=cssHooks["@:get"](t,e);return/px$/.test(n)?n:avalon(t).position()[e]+"px"}});var cssShow={position:"absolute",visibility:"hidden",display:"block"},rdisplayswap=/^(none|table(?!-c[ea]).+)/;"Width,Height".replace(rword,function(e){var t=e.toLowerCase(),n="client"+e,r="scroll"+e,i="offset"+e;cssHooks[t+":get"]=function(t,n,r){var i="content-box";typeof r=="string"&&(i=r),n=e==="Width"?["Left","Right"]:["Top","Bottom"];switch(i){case"content-box":return t["client"+e]-avalon.css(t,"padding"+n[0],!0)-avalon.css(t,"padding"+n[1],!0);case"padding-box":return t["client"+e];case"border-box":return t["offset"+e];case"margin-box":return t["offset"+e]+avalon.css(t,"margin"+n[0],!0)+avalon.css(t,"margin"+n[1],!0)}},cssHooks[t+"&get"]=function(e){var n=[];showHidden(e,n);var r=cssHooks[t+":get"](e);for(var i=0,s;s=n[i++];){e=s.node;for(var o in s)typeof s[o]=="string"&&(e.style[o]=s[o])}return r},avalon.fn[t]=function(s){var o=this[0];if(arguments.length===0){if(o.setTimeout)return o["inner"+e]||o.document.documentElement[n];if(o.nodeType===9){var u=o.documentElement;return Math.max(o.body[r],u[r],o.body[i],u[i],u[n])}return cssHooks[t+"&get"](o)}return this.css(t,s)},avalon.fn["inner"+e]=function(){return cssHooks[t+":get"](this[0],void 0,"padding-box")},avalon.fn["outer"+e]=function(e){return cssHooks[t+":get"](this[0],void 0,e===!0?"margin-box":"border-box")}}),avalon.fn.offset=function(){var e=this[0],t={left:0,top:0};if(!e||!e.tagName||!e.ownerDocument)return t;var n=e.ownerDocument,r=n.body,i=n.documentElement,s=n.defaultView||n.parentWindow;if(!avalon.contains(i,e))return t;typeof e.getBoundingClientRect!="undefined"&&(t=e.getBoundingClientRect());var o=i.clientTop||r.clientTop,u=i.clientLeft||r.clientLeft,a=Math.max(s.pageYOffset||0,i.scrollTop,r.scrollTop),f=Math.max(s.pageXOffset||0,i.scrollLeft,r.scrollLeft);return{top:t.top+a-o,left:t.left+f-u}};var roption=/^<option(?:\s+\w+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s>]+))?)*\s+value[\s=]/i,valHooks={"option:get":function(e){return e.hasAttribute?e.hasAttribute("value")?e.value:e.text.trim():roption.test(e.outerHTML)?e.value:e.text},"select:get":function(e,t){var n,r=e.options,i=e.selectedIndex,s=valHooks["option:get"],o=e.type==="select-one"||i<0,u=o?null:[],a=o?i+1:r.length,f=i<0?a:o?i:0;for(;f<a;f++){n=r[f];if((n.selected||f===i)&&!n.disabled){t=s(n);if(o)return t;u.push(t)}}return u},"select:set":function(e,t,n){t=[].concat(t);var r=valHooks["option:get"];for(var i=0,s;s=e.options[i++];)if(s.selected=t.indexOf(r(s))>=0)n=!0;n||(e.selectedIndex=-1)}},rtagName=/<([\w:]+)/,rxhtml=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,rcreate=W3C?/[^\d\D]/:/(<(?:script|link|style|meta|noscript))/ig,scriptTypes=oneObject("text/javascript","text/ecmascript","application/ecmascript","application/javascript","text/vbscript"),rnest=/<(?:tb|td|tf|th|tr|col|opt|leg|cap|area)/,tagHooks={area:[1,"<map>"],param:[1,"<object>"],col:[2,"<table><tbody></tbody><colgroup>","</table>"],legend:[1,"<fieldset>"],option:[1,"<select multiple='multiple'>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>"],td:[3,"<table><tbody><tr>"],_default:W3C?[0,""]:[1,"X<div>"]};tagHooks.optgroup=tagHooks.option,tagHooks.tbody=tagHooks.tfoot=tagHooks.colgroup=tagHooks.caption=tagHooks.thead,tagHooks.th=tagHooks.td;var script=DOC.createElement("script");avalon.parseHTML=function(e){typeof e!="string"&&(e+=""),e=e.replace(rxhtml,"<$1></$2>").trim();var t=(rtagName.exec(e)||["",""])[1].toLowerCase(),n=tagHooks[t]||tagHooks._default,r=hyperspace.cloneNode(!1),i=cinerator,s,o;W3C||(e=e.replace(rcreate,"<br class=msNoScope>$1")),i.innerHTML=n[1]+e+(n[2]||"");var u=i.getElementsByTagName("script");if(u.length)for(var a=0,f;f=u[a++];)if(!f.type||scriptTypes[f.type])o=script.cloneNode(!1),ap.forEach.call(f.attributes,function(e){e&&e.specified&&(o[e.name]=e.value)}),o.text=f.text,f.parentNode.replaceChild(o,f);for(a=n[0];a--;i=i.lastChild);if(!W3C)for(u=i.getElementsByTagName("br"),a=0;f=u[a++];)f.className&&f.className==="msNoScope"&&f.parentNode.removeChild(f);while(s=i.firstChild)r.appendChild(s);return r},avalon.innerHTML=function(e,t){if(!W3C&&!rcreate.test(t)&&!rnest.test(t))try{e.innerHTML=t;return}catch(n){}var r=this.parseHTML(t);this.clearHTML(e).appendChild(r)},avalon.clearHTML=function(e){return expelFromSanctuary(e),e};var Observable={$watch:function(e,t){if(typeof t=="function"){var n=this.$events[e];n?n.push(t):this.$events[e]=[t]}else this.$events=this.$watch.backup;return this},$unwatch:function(e,t){var n=arguments.length;if(n===0)this.$watch.backup=this.$events,this.$events={};else if(n===1)this.$events[e]=[];else{var r=this.$events[e]||[],i=r.length;while(~--i<0)if(r[i]===t)return r.splice(i,1)}return this},$fire:function(e){var t=!1,n=!1;e.match(/^bubble!(\w+)$/)?t=e=RegExp.$1:e.match(/^capture!(\w+)$/)&&(n=e=RegExp.$1);var r=this.$events,i=r[e]||[],s=r.$all||[],o=aslice.call(arguments,1);for(var u=0,a;a=i[u++];)a.apply(this,o);for(var u=0,a;a=s[u++];)a.apply(this,arguments);var f=r.element;if(f){var l=[e].concat(o);if(t)if(W3C)W3CFire(f,"dataavailable",l);else{var c=document.createEventObject();c.detail=l,f.fireEvent("ondataavailable",c)}else if(n){var h=[];for(var u in avalon.vmodels){var p=avalon.vmodels[u];if(p&&p.$events&&p.$events.element){var d=p.$events.element;avalon.contains(f,d)&&f!=d&&h.push(p)}}h.forEach(function(e){e.$fire.apply(e,l)})}}}};avalon.scan=function(e,t){e=e||root;var n=t?[].concat(t):[];scanTag(e,n)};var stopScan=oneObject("area,base,basefont,br,col,command,embed,hr,img,input,link,meta,param,source,track,wbr,noscript,script,style,textarea".toUpperCase()),interval=W3C?15:50,rmsAttr=/ms-(\w+)-?(.*)/,priorityMap={"if":10,repeat:90,widget:110,each:1400,"with":1500,duplex:2e3,on:3e3},ons=oneObject("animationend,blur,change,input,click,dblclick,focus,keydown,keypress,keyup,mousedown,mouseenter,mouseleave,mousemove,mouseout,mouseover,mouseup,scroll,submit");if(!"1"[0])var cacheAttrs=createCache(512),rattrs=/\s+(ms-[^=\s]+)(?:=("[^"]*"|'[^']*'|[^\s>]+))?/g,rquote=/^['"]/,rtag=/<\w+\b(?:(["'])[^"]*?(\1)|[^>])*>/i,ramp=/&amp;/g,getAttributes=function(e){var t=e.outerHTML;if(t.slice(0,2)==="</"||!t.trim())return[];var n=t.match(rtag)[0],r=[],i,s,o;if(cacheAttrs[n])return cacheAttrs[n];while(s=rattrs.exec(n)){o=s[2],o&&(o=(rquote.test(o)?o.slice(1,-1):o).replace(ramp,"&"));var u=s[1].toLowerCase();i=u.match(rmsAttr);var a={name:u,specified:!0,value:o||""};r.push(a)}return cacheAttrs(n,r)};var rfilters=/\|\s*(\w+)\s*(\([^)]*\))?/g,r11a=/\|\|/g,r11b=/U2hvcnRDaXJjdWl0/g,rlt=/&lt;/g,rgt=/&gt;/g,keywords="break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined",rrexpstr=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|[\s\t\n]*\.[\s\t\n]*[$\w\.]+/g,rsplit=/[^\w$]+/g,rkeywords=new RegExp(["\\b"+keywords.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),rnumber=/\b\d[^,]*/g,rcomma=/^,+|,+$/g,cacheVars=createCache(512),getVariables=function(e){e=","+e.trim();if(cacheVars[e])return cacheVars[e];var t=e.replace(rrexpstr,"").replace(rsplit,",").replace(rkeywords,"").replace(rnumber,"").replace(rcomma,"").split(/^$|,+/),n=[],r={};for(var i=0;i<t.length;++i){var s=t[i];r[s]||(r[s]=n.push(s))}return cacheVars(e,n)},cacheExprs=createCache(256),rduplex=/\w\[.*\]|\w\.\w/,rproxy=/(\$proxy\$[a-z]+)\d+$/;avalon.parseExprProxy=parseExprProxy;var cacheDisplay=oneObject("a,abbr,b,span,strong,em,font,i,kbd","inline");avalon.mix(cacheDisplay,oneObject("div,h1,h2,h3,h4,h5,h6,section,p","block")),avalon.parseDisplay=parseDisplay;var supportDisplay=function(e){return W3C?getComputedStyle(e,null).display==="table-cell":!0}(DOC.createElement("td")),propMap={"accept-charset":"acceptCharset","char":"ch",charoff:"chOff","class":"className","for":"htmlFor","http-equiv":"httpEquiv"},anomaly="accessKey,allowTransparency,bgColor,cellPadding,cellSpacing,codeBase,codeType,colSpan,contentEditable,dateTime,defaultChecked,defaultSelected,defaultValue,frameBorder,isMap,longDesc,maxLength,marginWidth,marginHeight,noHref,noResize,noShade,readOnly,rowSpan,tabIndex,useMap,vSpace,valueType,vAlign";anomaly.replace(rword,function(e){propMap[e.toLowerCase()]=e});var rdash=/\(([^)]*)\)/,cssText="<style id='avalonStyle'>.avalonHide{ display: none!important }</style>";head.insertBefore(avalon.parseHTML(cssText),head.firstChild);var rnoscripts=/<noscript.*?>(?:[\s\S]+?)<\/noscript>/img,rnoscriptText=/<noscript.*?>([\s\S]+?)<\/noscript>/im,getXHR=function(){return new(window.XMLHttpRequest||ActiveXObject)("Microsoft.XMLHTTP")},getBindingCallback=function(e,t,n){var r=e.getAttribute(t);if(r)for(var i=0,s;s=n[i++];)if(s.hasOwnProperty(r)&&typeof s[r]=="function")return s[r]},cacheTmpls=avalon.templateCache={},ifSanctuary=DOC.createElement("div");ifSanctuary.innerHTML="a";try{ifSanctuary.contains(ifSanctuary.firstChild),avalon.contains=function(e,t){return e.contains(t)}}catch(e){avalon.contains=fixContains}var bindingExecutors=avalon.bindingExecutors={attr:function(e,t,n){var r=n.type,i=n.param;if(r==="css")avalon(t).css(i,e);else if(r==="attr"){var s=e===!1||e===null||e===void 0;s?t.removeAttribute(i):W3C?s||t.setAttribute(i,e):(i=propMap[i]||i,s?t.removeAttribute(i):t[i]=e)}else if(r==="include"&&e){var o=n.vmodels,u=getBindingCallback(t,"data-include-rendered",o),a=getBindingCallback(t,"data-include-loaded",o);function f(e){a&&(e=a.apply(t,[e].concat(o))),avalon.innerHTML(t,e),scanNodes(t,o),u&&checkScan(t,function(){u.call(t)})}if(n.param==="src")if(cacheTmpls[e])f(cacheTmpls[e]);else{var l=getXHR();l.onreadystatechange=function(){if(l.readyState===4){var t=l.status;(t>=200&&t<300||t===304||t===1223)&&f(cacheTmpls[e]=l.responseText)}},l.open("GET",e,!0),"withCredentials"in l&&(l.withCredentials=!0),l.setRequestHeader("X-Requested-With","XMLHttpRequest"),l.send(null)}else{var c=e&&e.nodeType==1?e:DOC.getElementById(e);if(c){if(c.tagName==="NOSCRIPT"&&!c.innerHTML&&!c.fixIE78){var l=getXHR();l.open("GET",location,!1),l.send(null);var h=DOC.getElementsByTagName("noscript"),p=(l.responseText||"").match(rnoscripts)||[],d=p.length;for(var v=0;v<d;v++){var m=h[v];m&&(m.style.display="none",m.fixIE78=(p[v].match(rnoscriptText)||["","&nbsp;"])[1])}}avalon.nextTick(function(){f(c.fixIE78||c.innerText||c.innerHTML)})}}}else!root.hasAttribute&&typeof e=="string"&&(r==="src"||r==="href")&&(e=e.replace(/&amp;/g,"&")),t[r]=e},"class":function(e,t,n){var r=avalon(t),i=n.type;if(i==="class"&&n.param)r.toggleClass(n.param,!!e);else{var s=n._evaluator?!!n._evaluator.apply(t,n._args):!0,o=n._class||e;switch(i){case"class":s&&n.oldClass&&r.removeClass(n.oldClass),r.toggleClass(o,s),n.oldClass=o;break;case"hover":case"active":if(!n.init){if(i==="hover")var u="mouseenter",a="mouseleave";else t.tabIndex=t.tabIndex||-1,u="mousedown",a="mouseup",r.bind("mouseleave",function(){s&&r.removeClass(o)});r.bind(u,function(){s&&r.addClass(o)}),r.bind(a,function(){s&&r.removeClass(o)}),n.init=1}}}},data:function(e,t,n){var r="data-"+n.param;e&&typeof e=="object"?t[r]=e:t.setAttribute(r,String(e))},checked:function(e,t,n){var r=n.type;if(r==="enabled")t.disabled=!e;else{var i=r==="readonly"?"readOnly":r;t[i]=!!e}},repeat:function(e,t,n){if(e){var r=this,i=r.group,s=r.startRepeat&&r.startRepeat.parentNode;s&&(r.parent=s);var o=r.parent,u=r.proxies,a=hyperspace.cloneNode(!1);if(e==="del"||e==="move")var f=getLocatedNode(o,r,t);switch(e){case"add":var l=n,c=r.getter().length-1,h=[],p={};for(var d=0,v=l.length;d<v;d++){var m=d+t,g=getEachProxy(m,l[d],r,c);u.splice(m,0,g),p=shimController(r,a,h,g)}f=getLocatedNode(o,r,t),p.node=f,p.parent=o,o.insertBefore(a,f);for(var d=0,y;y=h[d++];)scanTag(y,r.vmodels);h=null;break;case"del":var b=u.splice(t,n);for(var d=0,g;g=b[d++];)recycleEachProxy(g);expelFromSanctuary(removeView(f,i,n));break;case"index":var c=u.length-1;for(;n=u[t];t++)n.$index=t,n.$first=t===0,n.$last=t===c;break;case"clear":if(r.startRepeat)for(;;){var y=r.startRepeat.nextSibling;if(!y||y===r.endRepeat)break;a.appendChild(y)}else a=o;expelFromSanctuary(a),u.length=0;break;case"move":var w=u.splice(t,1)[0];w&&(u.splice(n,0,w),a=removeView(f,i),f=getLocatedNode(o,r,n),o.insertBefore(a,f));break;case"set":var g=u[t];g&&(g[g.$itemName]=n);break;case"append":var E=n,S=getBindingCallback(r.callbackElement,"data-with-sorted",r.vmodels),x=[],h=[],p={};for(var T in t)t.hasOwnProperty(T)&&T!=="hasOwnProperty"&&x.push(T);if(S){var N=S.call(o,x);N&&Array.isArray(N)&&N.length&&(x=N)}for(var d=0,T;T=x[d++];)T!=="hasOwnProperty"&&(p=shimController(r,a,h,E[T]));p.parent=o,p.node=r.endRepeat||null,o.insertBefore(a,p.node);for(var d=0,n;n=h[d++];)scanTag(n,r.vmodels);h=null}iteratorCallback.call(r,arguments)}},html:function(e,t,n){e=e==null?"":e,t||(t=n.element=n.node.parentNode);if(n.replaceNodes){var r,i;if(e.nodeType===11)r=e;else if(e.nodeType===1||e.item){i=e.nodeType===1?e.childNodes:e.item?e:[],r=hyperspace.cloneNode(!0);while(i[0])r.appendChild(i[0])}else r=avalon.parseHTML(e);var s=avalon.slice(r.childNodes);t.insertBefore(r,n.replaceNodes[0]||null);for(var o=0,u;u=n.replaceNodes[o++];)t.removeChild(u);n.replaceNodes=s}else avalon.innerHTML(t,e);avalon.nextTick(function(){scanNodes(t,n.vmodels)})},"if":function(e,t,n){var r=n.placehoder;if(e){if(!n.msInDocument){n.msInDocument=!0;try{r.parentNode.replaceChild(t,r)}catch(i){log("debug: ms-if  "+i.message)}}rbind.test(t.outerHTML.replace(rlt,"<").replace(rgt,">"))&&scanAttr(t,n.vmodels)}else n.msInDocument&&(n.msInDocument=!1,t.parentNode.replaceChild(r,t),r.elem=t,ifSanctuary.appendChild(t))},on:function(e,t,n){var r=n.evaluator,i=n.args,s=n.vmodels;n.hasArgs?e=function(e){return r.apply(this,i.concat(e))}:e=function(e){return r.apply(0,i).call(this,e)},t.$vmodel=s[0],t.$vmodels=s,n.param=n.param.replace(/-\d+$/,"");if(typeof n.specialBind=="function")n.specialBind(t,e);else var o=avalon.bind(t,n.param,e);n.rollback=function(){typeof n.specialUnbind=="function"?n.specialUnbind():avalon.unbind(t,n.param,o)},n.evaluator=n.handler=noop},text:function(e,t,n){e=e==null?"":e;var r=n.node;if(n.nodeType===3)try{r.data=e}catch(i){}else t||(t=n.element=r.parentNode),"textContent"in t?t.textContent=e:t.innerText=e},visible:function(e,t,n){t.style.display=e?n.display:"none"},widget:noop},rwhitespace=/^\s+$/,bindingHandlers=avalon.bindingHandlers={attr:function(e,t){var n=e.value.trim(),r=!0;n.indexOf(openTag)>-1&&n.indexOf(closeTag)>2&&(r=!1,rexpr.test(n)&&RegExp.rightContext===""&&RegExp.leftContext===""&&(r=!0,n=RegExp.$1)),e.handlerName="attr",parseExprProxy(n,t,e,r?null:scanExpr(e.value))},checked:function(e,t){e.handlerName="checked",parseExprProxy(e.value,t,e)},"class":function(e,t){var n=e.param,r=e.value,i;e.handlerName="class";if(!n||isFinite(n)){e.param="";var s=r.replace(rexprg,function(e){return Math.pow(10,e.length-1)}),o=s.indexOf(":");if(o===-1)var u=r;else{u=r.slice(0,o),i=r.slice(o+1),parseExpr(i,t,e);if(!e.evaluator)return log("debug: ms-class '"+(i||"").trim()+"' 不存在于VM中"),!1;e._evaluator=e.evaluator,e._args=e.args}var a=rexpr.test(u);a||(e._class=u),parseExprProxy("",t,e,a?scanExpr(u):null)}else e.type==="class"&&parseExprProxy(r,t,e)},duplex:function(e,t){var n=e.element,r=n.tagName;if(typeof duplexBinding[r]=="function"){e.changed=getBindingCallback(n,"data-duplex-changed",t)||noop,parseExpr(e.value,t,e,"duplex");if(e.evaluator&&e.args){var i=n.form;i&&i.msValidate&&i.msValidate(n),e.bound=function(t,r){n.addEventListener?n.addEventListener(t,r,!1):n.attachEvent("on"+t,r);var i=e.rollback;e.rollback=function(){avalon.unbind(n,t,r),i&&i()}},duplexBinding[n.tagName](n,e.evaluator.apply(null,e.args),e)}}},repeat:function(e,t){var n=e.type,r;parseExpr(e.value,t,e),n!=="repeat"&&log("warning:建议使用ms-repeat代替ms-each, ms-with, ms-repeat只占用一个标签并且性能更好");var i=e.callbackElement=e.parent=e.element;e.getter=function(){return this.evaluator.apply(0,this.args||[])},e.proxies=[];var s=!0;try{r=e.getter();var o=getType(r);if(o=="object"||o=="array")s=!1}catch(u){}var a=hyperspace.cloneNode(!1);if(n==="repeat"){var f=DOC.createComment("ms-repeat-start"),l=DOC.createComment("ms-repeat-end");e.element=e.parent=i.parentNode,e.startRepeat=f,e.endRepeat=l,i.removeAttribute(e.name),e.parent.replaceChild(l,i),e.parent.insertBefore(f,l),a.appendChild(i)}else{var c;while(c=i.firstChild)c.nodeType===3&&rwhitespace.test(c.data)?i.removeChild(c):a.appendChild(c)}e.template=a,e.rollback=function(){bindingExecutors.repeat.call(e,"clear");var t=e.endRepeat,n=e.parent;n.insertBefore(e.template,t||null),t&&(n.removeChild(t),n.removeChild(e.startRepeat),e.element=e.callbackElement)};var h=e.value.split(".")||[];if(h.length>1){h.pop();var p=h[0];for(var d=0,v;v=t[d++];)if(v&&v.hasOwnProperty(p)&&v[p][subscribers]){v[p][subscribers].push(e);break}}if(s)return;e.callbackName="data-"+n+"-rendered",e.handler=bindingExecutors.repeat,e.$outer={};var m="$key",g="$val";Array.isArray(r)&&(m="$first",g="$last");for(var d=0,y;y=t[d++];)if(y.hasOwnProperty(m)&&y.hasOwnProperty(g)){e.$outer=y;break}c=a.firstChild,e.fastRepeat=!!c&&c.nodeType===1&&a.lastChild===c&&!c.attributes["ms-controller"]&&!c.attributes["ms-important"],r[subscribers]&&r[subscribers].push(e);if(!Array.isArray(r)&&n!=="each"){var b=withProxyPool[r.$id];if(!b){withProxyCount++,b=withProxyPool[r.$id]={};for(var w in r)r.hasOwnProperty(w)&&w!=="hasOwnProperty"&&function(e,t){b[e]=createWithProxy(e,t,{}),b[e].$watch("$val",function(t){r[e]=t})}(w,r[w])}e.handler("append",r,b)}else e.handler("add",0,r)},html:function(e,t){parseExprProxy(e.value,t,e)},"if":function(e,t){var n=e.element;n.removeAttribute(e.name),e.placehoder||(e.msInDocument=e.placehoder=DOC.createComment("ms-if")),e.vmodels=t,parseExprProxy(e.value,t,e)},on:function(e,t){var n=e.value,r="$event";if(n.indexOf("(")>0&&n.indexOf(")")>-1){var i=(n.match(rdash)||["",""])[1].trim();if(i===""||i==="$event")r=void 0,n=n.replace(rdash,"")}else r=void 0;e.hasArgs=r,parseExprProxy(n,t,e,r)},visible:function(e,t){var n=e.element;if(!supportDisplay&&!root.contains(n))var r=parseDisplay(n.tagName);r=r||avalon(n).css("display"),e.display=r==="none"?parseDisplay(n.tagName):r,parseExprProxy(e.value,t,e)},widget:function(e,t){var n=e.value.match(rword),r=e.element,i=n[0];if(n[1]==="$"||!n[1])n[1]=i+setTimeout("1");e.value=n.join(",");var s=avalon.ui[i];if(typeof s=="function"){t=r.vmodels||t;var o=n[2]||i;for(var u=0,a;a=t[u++];)if(a.hasOwnProperty(o)&&typeof a[o]=="object"){var f=a;break}if(f){var l=f[o];l=l.$model||l;var c=l[i+"Id"];typeof c=="string"&&(n[1]=c)}var h=avalon.getWidgetData(r,n[0]);e[i+"Id"]=n[1],e[i+"Options"]=avalon.mix({},s.defaults,l||{},h),r.removeAttribute("ms-widget");var p=s(r,e,t)||{};e.evaluator=noop,r.msData["ms-widget-id"]=p.$id||"",p.hasOwnProperty("$init")&&p.$init();if(p.hasOwnProperty("$remove")){var d=function(){p.$remove(),r.msData={},delete VMODELS[p.$id]};supportMutationEvents?r.addEventListener("DOMNodeRemoved",function(e){e.target===this&&!this.msRetain&&(window.chrome?this.tagName==="INPUT"&&this.relatedNode.nodeType===1:1)&&d()}):(r.offTree=d,launchImpl(r))}}else t.length&&(r.vmodels=t)}},supportMutationEvents=W3C&&DOC.implementation.hasFeature("MutationEvents","2.0");"hover,active".replace(rword,function(e){bindingHandlers[e]=bindingHandlers["class"]}),"with,each".replace(rword,function(e){bindingHandlers[e]=bindingHandlers.repeat}),"disabled,enabled,readonly,selected".replace(rword,function(e){bindingHandlers[e]=bindingHandlers.checked}),bindingHandlers.data=bindingHandlers.text=bindingHandlers.html,"title,alt,src,value,css,include,href".replace(rword,function(e){bindingHandlers[e]=bindingHandlers.attr});var duplexBinding=bindingHandlers.duplex;duplexBinding.INPUT=function(e,t,n){var r=n.param,i=e.type,s=n.bound,o=avalon(e),u=!1,a=!1,f=function(e){u=!0,n.changed.call(this,e)},l=function(){a=!0},c=function(){a=!1},h=function(){if(a)return;var n=e.oldValue=e.value;o.data("duplex-observe")!==!1&&(t(n),f.call(e,n))};n.handler=function(){var n=t();n!==e.value&&(e.value=n+"")},i==="checkbox"&&r==="radio"&&(i="radio");if(i==="radio")n.handler=function(){e.defaultChecked=e.checked=/bool|text/.test(r)?t()+""===e.value:!!t()},h=function(){if(o.data("duplex-observe")!==!1){var n=e.value;r==="text"?t(n):r==="bool"?(n=n==="true",t(n)):(n=!e.defaultChecked,t(n),e.checked=n),f.call(e,n)}},s(r?"click":"mousedown",h);else if(i==="checkbox")h=function(){if(o.data("duplex-observe")!==!1){var n=e.checked?"ensure":"remove",r=t();Array.isArray(r)?avalon.Array[n](r,e.value):avalon.error("ms-duplex位于checkbox时要求对应一个数组"),f.call(e,r)}},n.handler=function(){var n=[].concat(t());e.checked=n.indexOf(e.value)>=0},s(W3C?"change":"click",h);else{var p=e.attributes["data-duplex-event"]||e.attributes["data-event"]||{};p=p.value;if(p==="change")s("change",h);else if(W3C&&DOC.documentMode!==9)s("input",h),s("compositionstart",l),s("compositionend",c);else{var d=["keyup","paste","cut","change"];function v(e){var t=e.keyCode;if(t===91||15<t&&t<19||37<=t&&t<=40)return;e.type==="cut"?avalon.nextTick(h):h()}d.forEach(function(t){e.attachEvent("on"+t,v)}),n.rollback=function(){d.forEach(function(t){e.detachEvent("on"+t,v)})}}}e.onTree=onTree,launch(e),e.oldValue=e.value,registerSubscriber(n);var m=setTimeout(function(){u||f.call(e,e.value),clearTimeout(m)},31)};var TimerID,ribbon=[],launch=noop;try{var inputProto=HTMLInputElement.prototype;Object.getOwnPropertyNames(inputProto);var oldSetter=Object.getOwnPropertyDescriptor(inputProto,"value").set;Object.defineProperty(inputProto,"value",{set:newSetter})}catch(e){launch=launchImpl}duplexBinding.SELECT=function(e,t,n){function i(){if(r.data("duplex-observe")!==!1){var i=r.val();i+""!==e.oldValue&&(t(i),e.oldValue=i+""),n.changed.call(e,i)}}var r=avalon(e);n.handler=function(){var n=t();n=n&&n.$model||n,n=Array.isArray(n)?n.map(String):n+"",n+""!==e.oldValue&&(r.val(n),e.oldValue=n+"")},n.bound("change",i);var s=NaN,o=setInterval(function(){var r=e.innerHTML;r===s?(clearInterval(o),registerSubscriber(n),n.changed.call(e,t())):s=r},20)},duplexBinding.TEXTAREA=duplexBinding.INPUT;var eventHooks=avalon.eventHooks;"onmouseenter"in root||avalon.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){eventHooks[e]={type:t,deel:function(t,n){return function(r){var i=r.relatedTarget;if(!i||i!==t&&!(t.compareDocumentPosition(i)&16))return delete r.type,r.type=e,n.call(t,r)}}}}),avalon.each({AnimationEvent:"animationend",WebKitAnimationEvent:"webkitAnimationEnd"},function(e,t){window[e]&&!eventHooks.animationend&&(eventHooks.animationend={type:t})}),"oninput"in document.createElement("input")||(eventHooks.input={type:"propertychange",deel:function(e,t){return function(n){if(n.propertyName==="value")return n.type="input",t.call(e,n)}}}),document.onmousewheel===void 0&&(eventHooks.mousewheel={type:"DOMMouseScroll",deel:function(e,t){return function(n){n.wheelDelta=n.detail>0?-120:120,Object.defineProperty&&Object.defineProperty(n,"type",{value:"mousewheel"}),t.call(e,n)}}});var _splice=ap.splice,CollectionPrototype={_splice:_splice,_add:function(e,t){var n=this.length;t=typeof t=="number"?t:n;var r=[];for(var i=0,s=e.length;i<s;i++)r[i]=convert(e[i]);_splice.apply(this,[t,0].concat(r)),notifySubscribers(this,"add",t,r);if(!this._stopFireLength)return this._.length=this.length},_del:function(e,t){var n=this._splice(e,t);return n.length&&(notifySubscribers(this,"del",e,t),this._stopFireLength||(this._.length=this.length)),n},push:function(){ap.push.apply(this.$model,arguments);var e=this._add(arguments);return notifySubscribers(this,"index",e>2?e-2:0),e},pushArray:function(e){return this.push.apply(this,e)},unshift:function(){return ap.unshift.apply(this.$model,arguments),this._add(arguments,0),notifySubscribers(this,"index",arguments.length),this.$model.length},shift:function(){var e=this.$model.shift();return this._del(0,1),notifySubscribers(this,"index",0),e},pop:function(){var e=this.$model.pop();return this._del(this.length-1,1),e},splice:function(e,t){e=resetNumber(e,this.length);var n=_splice.apply(this.$model,arguments),r=[],i;return this._stopFireLength=!0,n.length&&(r=this._del(e,n.length),i=!0),arguments.length>2&&(this._add(aslice.call(arguments,2),e),i=!0),this._stopFireLength=!1,this._.length=this.length,i&&notifySubscribers(this,"index",0),r},contains:function(e){return this.indexOf(e)!==-1},size:function(){return this._.length},remove:function(e){return this.removeAt(this.indexOf(e))},removeAt:function(e){return e>=0?this.splice(e,1):[]},clear:function(){return this.$model.length=this.length=this._.length=0,notifySubscribers(this,"clear",0),this},removeAll:function(e){if(Array.isArray(e))e.forEach(function(e){this.remove(e)},this);else if(typeof e=="function")for(var t=this.length-1;t>=0;t--){var n=this[t];e(n,t)&&this.splice(t,1)}else this.clear()},ensure:function(e){return this.contains(e)||this.push(e),this},set:function(e,t){if(e>=0){var n=getType(t);t&&t.$model&&(t=t.$model);var r=this[e];if(n==="object")for(var i in t)r.hasOwnProperty(i)&&(r[i]=t[i]);else n==="array"?r.clear().push.apply(r,t):r!==t&&(this[e]=t,this.$model[e]=t,notifySubscribers(this,"set",e,t))}return this}};"sort,reverse".replace(rword,function(e){CollectionPrototype[e]=function(){var t=this.$model,n=t.slice(0),r=!1;ap[e].apply(t,arguments);for(var i=0,s=n.length;i<s;i++){var o=t[i],u=n[i];if(!isEqual(o,u)){r=!0;var a=n.indexOf(o,i),f=this._splice(a,1)[0],l=n.splice(a,1)[0];this._splice(i,0,f),n.splice(i,0,l),notifySubscribers(this,"move",a,i)}}return n=void 0,r&&notifySubscribers(this,"index",0),this}});var queryComments=DOC.createTreeWalker?function(e){var t=DOC.createTreeWalker(e,NodeFilter.SHOW_COMMENT,null,null),n,r=[];while(n=t.nextNode())r.push(n);return r}:function(e){return e.getElementsByTagName("!")},watchEachOne=oneObject("$index,$first,$last"),eachProxyPool=[],rscripts=/<script[^>]*>([\S\s]*?)<\/script\s*>/gim,raimg=/^<(a|img)\s/i,ron=/\s+(on[^=\s]+)(?:=("[^"]*"|'[^']*'|[^\s>]+))?/g,ropen=/<\w+\b(?:(["'])[^"]*?(\1)|[^>])*>/ig,rjavascripturl=/\s+(src|href)(?:=("javascript[^"]*"|'javascript[^']*'))?/ig,rsurrogate=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,rnoalphanumeric=/([^\#-~| |!])/g,filters=avalon.filters={uppercase:function(e){return e.toUpperCase()},lowercase:function(e){return e.toLowerCase()},truncate:function(e,t,n){return t=t||30,n=n===void 0?"...":n,e.length>t?e.slice(0,t-n.length)+n:String(e)},camelize:camelize,sanitize:function(e){return e.replace(rscripts,"").replace(ropen,function(e,t){return raimg.test(e)&&(e=e.replace(rjavascripturl," $1=''")),e.replace(ron," ").replace(/\s+/g," ")})},escape:function(e){return String(e).replace(/&/g,"&amp;").replace(rsurrogate,function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1);return"&#"+((t-55296)*1024+(n-56320)+65536)+";"}).replace(rnoalphanumeric,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")},currency:function(e,t){return t=t||"￥",t+avalon.filters.number(e)},number:function(e,t,n,r){e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var i=isFinite(+e)?+e:0,s=isFinite(+t)?Math.abs(t):0,o=r||",",u=n||".",a="",f=function(e,t){var n=Math.pow(10,t);return""+Math.round(e*n)/n};return a=(s?f(i,s):""+Math.round(i)).split("."),a[0].length>3&&(a[0]=a[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,o)),(a[1]||"").length<s&&(a[1]=a[1]||"",a[1]+=(new Array(s-a[1].length+1)).join("0")),a.join(u)}};new function(){function e(e){return parseInt(e,10)}function t(e,t,n){var r="";e<0&&(r="-",e=-e),e=""+e;while(e.length<t)e="0"+e;return n&&(e=e.substr(e.length-t)),r+e}function n(e,n,r,i){return function(s){var o=s["get"+e]();if(r>0||o>-r)o+=r;return o===0&&r===-12&&(o=12),t(o,n,i)}}function r(e,t){return function(n,r){var i=n["get"+e](),s=(t?"SHORT"+e:e).toUpperCase();return r[s][i]}}function i(e){var n=-1*e.getTimezoneOffset(),r=n>=0?"+":"";return r+=t(Math[n>0?"floor":"ceil"](n/60),2)+t(Math.abs(n%60),2),r}function s(e,t){return e.getHours()<12?t.AMPMS[0]:t.AMPMS[1]}function l(t){var n;if(n=t.match(f)){var r=new Date(0),i=0,s=0,o=n[8]?r.setUTCFullYear:r.setFullYear,u=n[8]?r.setUTCHours:r.setHours;n[9]&&(i=e(n[9]+n[10]),s=e(n[9]+n[11])),o.call(r,e(n[1]),e(n[2])-1,e(n[3]));var a=e(n[4]||0)-i,l=e(n[5]||0)-s,c=e(n[6]||0),h=Math.round(parseFloat("0."+(n[7]||0))*1e3);return u.call(r,a,l,c,h),r}return t}var o={yyyy:n("FullYear",4),yy:n("FullYear",2,0,!0),y:n("FullYear",1),MMMM:r("Month"),MMM:r("Month",!0),MM:n("Month",2,1),M:n("Month",1,1),dd:n("Date",2),d:n("Date",1),HH:n("Hours",2),H:n("Hours",1),hh:n("Hours",2,-12),h:n("Hours",1,-12),mm:n("Minutes",2),m:n("Minutes",1),ss:n("Seconds",2),s:n("Seconds",1),sss:n("Milliseconds",3),EEEE:r("Day"),EEE:r("Day",!0),a:s,Z:i},u=/((?:[^yMdHhmsaZE']+)|(?:'(?:[^']|'')*')|(?:E+|y+|M+|d+|H+|h+|m+|s+|a|Z))(.*)/,a=/^\d+$/,f=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,c=/^(\d+)-(\d+)-(\d{4})$/,h=/^(\d+)\s+(\d+),(\d{4})$/;filters.date=function(t,n){var r=filters.date.locate,i="",s=[],f,p;n=n||"mediumDate",n=r[n]||n;if(typeof t=="string"){if(a.test(t))t=e(t);else{var d=t.trim();if(d.match(c)||d.match(h))t=RegExp.$3+"/"+RegExp.$1+"/"+RegExp.$2;t=l(t)}t=new Date(t)}typeof t=="number"&&(t=new Date(t));if(getType(t)!=="date")return;while(n)p=u.exec(n),p?(s=s.concat(p.slice(1)),n=s.pop()):(s.push(n),n=null);return s.forEach(function(e){f=o[e],i+=f?f(t,r):e.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),i};var p={AMPMS:{0:"上午",1:"下午"},DAY:{0:"星期日",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"},MONTH:{0:"1月",1:"2月",2:"3月",3:"4月",4:"5月",5:"6月",6:"7月",7:"8月",8:"9月",9:"10月",10:"11月",11:"12月"},SHORTDAY:{0:"周日",1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六"},fullDate:"y年M月d日EEEE",longDate:"y年M月d日",medium:"yyyy-M-d ah:mm:ss",mediumDate:"yyyy-M-d",mediumTime:"ah:mm:ss","short":"yy-M-d ah:mm",shortDate:"yy-M-d",shortTime:"ah:mm"};p.SHORTMONTH=p.MONTH,filters.date.locate=p};var innerRequire,modules=avalon.modules={"ready!":{exports:avalon},avalon:{exports:avalon,state:2}};new function(){function r(e){return(e||"").replace(/[?#].*/,"")}function o(e){var t;try{a.b.c()}catch(n){t=n.stack,!t&&window.opera&&(t=(String(n).match(/of linked script \S+/g)||[]).join(" "))}if(t)return t=t.split(/[@ ]/g).pop(),t=t[0]==="("?t.slice(1,-1):t.replace(/\s/,""),t.replace(/(:\d+)?:\d+$/i,"");var r=(e?DOC:head).getElementsByTagName("script");for(var i=r.length,s;s=r[--i];)if((e||s.className===subscribers)&&s.readyState==="interactive")return s.className=s.src}function u(e,t){for(var n in e)if(e[n]==="司徒正美"&&modules[n].state!==2&&(n===t||u(modules[n].deps,t)))return!0}function f(){e:for(var t=e.length,n;n=e[--t];){var r=modules[n],i=r.deps;for(var s in i)if(ohasOwn.call(i,s)&&modules[s].state!==2)continue e;r.state!==2&&(e.splice(t,1),d(r.id,r.args,r.factory),f())}}function l(e,t,n){var i=r(e.src);e.onload=e.onreadystatechange=e.onerror=null;if(!(t||n&&!modules[i].state))return!0;setTimeout(function(){head.removeChild(e),e=null}),log("debug: 加载 "+i+" 失败"+t+" "+!modules[i].state)}function h(e,t,i,s){if(e==="ready!"||modules[e]&&modules[e].state===2)return e;var o;e=e.replace(/^\w+!/,function(e){return o=e.slice(0,-1),""}),o=o||"js",o=plugins[o]||noop,typeof kernel.shim[e]=="object"&&(s=kernel.shim[e]),kernel.paths[e]&&(e=kernel.paths[e]);if(/^(\w+)(\d)?:.*/.test(e))i=e;else{t=t.substr(0,t.lastIndexOf("/"));var u=e.charAt(0);if(u!=="."&&u!=="/")i=n+e;else if(e.slice(0,2)==="./")i=t+e.slice(1);else if(e.slice(0,2)===".."){i=t+"/"+e;while(c.test(i))i=i.replace(c,"")}else u==="/"?i=e:avalon.error("不符合模块标识规则: "+e)}e=r(i);var a=o.ext;return a&&e.slice(0-a.length)!==a&&(i+=a),kernel.nocache&&(i+=(i.indexOf("?")===-1?"?":"&")+(new Date-0)),o(i,s)}function p(e,n,r){var i=DOC.createElement("script");i.className=subscribers,i[W3C?"onload":"onreadystatechange"]=function(){if(W3C||/loaded|complete/i.test(i.readyState)){var s=t.pop();s&&s.delay(n),r&&r(),l(i,!1,!W3C)&&log("debug: 已成功加载 "+e)}},i.onerror=function(){l(i,!0)},i.src=e,head.insertBefore(i,head.firstChild),log("debug: 正准备加载 "+e)}function d(e,t,n){for(var r=0,i=[],s;s=t[r++];)i.push(modules[s].exports);var o=Object(modules[e]),u=n.apply(window,i);return o.state=2,u!==void 0&&(modules[e].exports=u),u}var e=[],t=[],n;plugins.js=function(e,t){var n=r(e);return modules[n]||(modules[n]={id:n,exports:{}},t?innerRequire(t.deps||"",function(){p(e,n,function(){modules[n].state=2,t.exports&&(modules[n].exports=typeof t.exports=="function"?t.exports():window[t.exports]),innerRequire.checkDeps()})}):p(e,n)),n},plugins.css=function(e){var t=e.replace(/(#.+|\W)/g,"");if(!DOC.getElementById(t)){var n=DOC.createElement("link");n.rel="stylesheet",n.href=e,n.id=t,head.insertBefore(n,head.firstChild)}},plugins.css.ext=".css",plugins.js.ext=".js",plugins.text=function(e){var t=getXHR(),n=e.replace(/[?#].*/,"");return modules[n]={},t.onreadystatechange=function(){if(t.readyState===4){var r=t.status;r>399&&r<600?avalon.error(e+" 对应资源不存在或没有开启 CORS"):(modules[n].state=2,modules[n].exports=t.responseText,innerRequire.checkDeps())}},t.open("GET",e,!0),"withCredentials"in t&&(t.withCredentials=!0),t.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.send(),n};var i=o(!0);i||(i=avalon.slice(DOC.scripts).pop().src);var s=r(i);n=kernel.base=s.slice(0,s.lastIndexOf("/")+1);var c=/\/\w+\/\.\./;innerRequire=avalon.require=function(t,r,i){var s={},o=[],u=0,a=0,l=i||"callback"+setTimeout("1");i=i||n,String(t).replace(rword,function(e){var t=h(e,i);t&&(u++,modules[t]&&modules[t].state===2&&a++,s[t]||(o.push(t),s[t]="司徒正美"))}),modules[l]={id:l,factory:r,deps:s,args:o,state:1},u===a?d(l,o,r):e.unshift(l),f()},innerRequire.define=function(e,n,i){var s=aslice.call(arguments);if(typeof e=="string")var a=s.shift();typeof s[0]=="function"&&s.unshift([]);var f=modules[a]&&modules[a].state>=1?a:r(o());!modules[f]&&a&&(modules[f]={id:f,factory:i,state:1}),i=s[1],i.id=a,i.delay=function(e){s.push(e);var t=!0;try{t=u(modules[e].deps,e)}catch(n){}t&&avalon.error(e+"模块与之前的模块存在循环依赖，请不要直接用script标签引入"+e+"模块"),delete i.delay,innerRequire.apply(null,s)},f?i.delay(f,s):t.push(i)},innerRequire.define.amd=modules,innerRequire.config=kernel,innerRequire.checkDeps=f};var ready=W3C?"DOMContentLoaded":"readystatechange";DOC.readyState==="complete"?setTimeout(fireReady):W3C?(DOC.addEventListener(ready,fireReady),window.addEventListener("load",fireReady)):(DOC.attachEvent("onreadystatechange",function(){DOC.readyState==="complete"&&fireReady()}),window.attachEvent("onload",fireReady),root.doScroll&&doScrollCheck()),avalon.config({loader:!0}),avalon.ready=function(e){innerRequire("ready!",e)},avalon.ready(function(){if(window.VBArray&&!window.setImmediate){var e=[];function t(){var t=e.shift();t&&(t(),e.length&&avalon.nextTick())}avalon.nextTick=function(n){typeof n=="function"&&e.push(n);var r=DOC.createElement("script");r.onreadystatechange=function(){t(),r.onreadystatechange=null,head.removeChild(r),r=null},head.appendChild(r)}}avalon.scan(DOC.body)})})(document),define("avalon",function(){}),require(["avalon"],function(){var e=avalon.define("reg",function(e){e.username=""})}),define("reg",function(){});